<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y√∂netim Paneli | Dark</title>
    <style>
        /* --- KOYU TEMA AYARLARI --- */
        :root {
            --primary-color: #ffffff;
            --accent-color: #0a84ff;
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --text-main: #ffffff;
            --text-muted: #8e8e93;
            --radius: 16px;
            --border: #2c2c2e;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-color);
            min-height: 100vh;
            margin: 0; padding: 20px 15px;
            color: var(--text-main);
        }

        .container { 
            max-width: 600px; margin: auto; 
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: var(--radius); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            border: 1px solid var(--border);
        }

        h2 { text-align: center; margin: 0 0 5px 0; font-size: 22px; font-weight: 700; }
        .subtitle { text-align: center; color: var(--text-muted); font-size: 13px; margin-bottom: 25px; }

        /* Y√úKLEME KUTUSU */
        .upload-box { 
            background: #111; 
            padding: 20px; 
            border-radius: 12px; 
            border: 2px dashed #3a3a3c; 
            text-align: center; 
            margin-bottom: 25px; 
        }

        input[type="file"] { display: none; }
        .custom-file-upload {
            display: inline-block; padding: 12px 20px;
            cursor: pointer; background: #2c2c2e;
            color: white; border-radius: 10px; font-weight: 600; font-size: 14px;
            margin-bottom: 15px; border: 1px solid #3a3a3c;
        }
        #fileNameDisplay { display: block; font-size: 12px; color: var(--accent-color); margin-bottom: 15px; font-weight: bold; }

        /* INPUTLAR (ALT ALTA & YAN YANA) */
        .input-stack { display: flex; flex-direction: column; gap: 10px; }
        .input-row { display: flex; gap: 10px; }

        input { 
            width: 100%; padding: 14px; 
            background: #000; border: 1px solid #3a3a3c; 
            border-radius: 10px; font-size: 15px; color: white;
            box-sizing: border-box; outline: none;
        }
        input:focus { border-color: var(--accent-color); }

        button.btn-add { 
            width: 100%; background: var(--accent-color); 
            color: white; border: none; padding: 15px; 
            border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px;
            margin-top: 10px;
        }

        #statusText { color: var(--accent-color); font-weight: 600; font-size: 13px; margin-top: 15px; display: none; }

        /* Lƒ∞STE */
        .product-list { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .product-item { 
            display: flex; align-items: center; justify-content: space-between; 
            background: #2c2c2e; padding: 10px; border-radius: 10px; 
        }
        .product-info { display: flex; align-items: center; gap: 12px; }
        .product-info img { width: 50px; height: 50px; object-fit: cover; border-radius: 6px; background: #000; }
        .product-details { display: flex; flex-direction: column; }
        .product-details span.title { font-weight: 600; font-size: 14px; color: white; }
        .product-details span.meta { font-size: 12px; color: #8e8e93; margin-top: 2px; }

        button.btn-delete { 
            background: rgba(255, 69, 58, 0.2); color: #ff453a; 
            border: none; padding: 8px 12px; border-radius: 6px; font-weight: 600; font-size: 12px; 
        }

        /* AR≈ûƒ∞V */
        .archive-section { 
            border-top: 1px solid var(--border); 
            padding-top: 20px; margin-top: 25px; display: none; 
        }
        .archive-header h3 { margin: 0 0 10px 0; font-size: 15px; color: white; }
        .archive-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; 
        }
        .archive-item { 
            position: relative; border-radius: 8px; overflow: hidden; cursor: pointer; aspect-ratio: 1;
        }
        .archive-item img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
        .archive-overlay { 
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; 
            color: white; font-weight: bold; font-size: 20px; opacity: 0;
        }
        .archive-item:hover img { opacity: 1; }
        .archive-item:hover .archive-overlay { opacity: 1; }
    </style>
</head>
<body>

<div class="container">
    <h2>Y√∂netim Paneli</h2>
    <div class="subtitle">Vitrin & ƒ∞√ßerik Y√∂netimi</div>

    <div class="upload-box">
        <label for="fileInput" class="custom-file-upload">üì∏ Fotoƒüraf Se√ß</label>
        <input type="file" id="fileInput" accept="image/*" onchange="dosyaSecildi(this)">
        <span id="fileNameDisplay">Dosya se√ßilmedi</span>
        
        <div class="input-stack">
            <input type="text" id="nameInput" placeholder="√úr√ºn Adƒ± (Zorunlu)">
            
            <div class="input-row">
                <input type="number" id="priceInput" placeholder="Fiyat (TL)">
                <input type="text" id="skuInput" placeholder="Stok Kodu">
            </div>

            <div class="input-row">
                <input type="number" id="enInput" placeholder="En (cm)">
                <input type="number" id="boyInput" placeholder="Boy (cm)">
            </div>
            
            <input type="text" id="collInput" placeholder="Koleksiyon">

            <button class="btn-add" onclick="urunuYukle()">Listeye Ekle</button>
        </div>
        <p id="statusText">ƒ∞≈ülem Yapƒ±lƒ±yor... ‚è≥</p>
    </div>

    <div class="product-list" id="productList"></div>

    <div class="archive-section" id="archiveSection">
        <div class="archive-header">
            <h3>‚òÅÔ∏è Ar≈üiv (Geri Y√ºkle)</h3>
        </div>
        <div class="archive-grid" id="archiveGrid"></div>
    </div>
</div>

<script>
    // --- SENƒ∞N AYARLARIN ---
    const KULLANICI = "fthlabz"; 
    const REPO = "sanal-kesif"; 
    const token1 = "ghp_";
    const token2 = "dm7qeynDwgjzBO5uOg02AFW4OhXZXH1cMdUG"; 
    const githubToken = token1 + token2;

    let vitrin = [];

    // --- SENƒ∞N √áALI≈ûAN Sƒ∞STEM BA≈ûLANGICI ---
    function dosyaSecildi(input) {
        const isim = input.files.length > 0 ? input.files[0].name : "Dosya se√ßilmedi";
        document.getElementById('fileNameDisplay').innerText = "‚úÖ " + isim;
    }

    async function sistemiBaslat() {
        try {
            const cevap = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/vitrin.json?t=${Date.now()}`);
            if (cevap.ok) { vitrin = await cevap.json(); vitriniCiz(); }
        } catch (e) { console.log("ƒ∞lk defa defter olu≈üturulacak."); }
        arsiviGetir();
    }
    sistemiBaslat();

    async function arsiviGetir() {
        try {
            const cevap = await fetch(`https://api.github.com/repos/${KULLANICI}/${REPO}/contents/images`, {
                headers: { 'Authorization': `token ${githubToken}` }
            });
            
            if (cevap.ok) {
                const dosyalar = await cevap.json();
                const vitrinUrlleri = vitrin.map(u => u.url);
                const arsivDosyalari = dosyalar.filter(d => 
                    (d.name.endsWith('.jpg') || d.name.endsWith('.png') || d.name.endsWith('.webp')) && 
                    !vitrinUrlleri.includes(d.download_url)
                );
                arsiviCiz(arsivDosyalari);
            }
        } catch (e) { console.log("Ar≈üiv taranamadƒ±."); }
    }

    function arsiviCiz(dosyalar) {
        const grid = document.getElementById('archiveGrid');
        const section = document.getElementById('archiveSection');
        if(dosyalar.length === 0) { section.style.display = 'none'; return; }
        
        section.style.display = 'block';
        grid.innerHTML = "";
        
        dosyalar.forEach(dosya => {
            grid.innerHTML += `
                <div class="archive-item" onclick="arsivdenVitrineEkle('${dosya.download_url}')">
                    <img src="${dosya.download_url}" loading="lazy">
                    <div class="archive-overlay">+</div>
                </div>
            `;
        });
    }

    async function arsivdenVitrineEkle(url) {
        // Hƒ±zlƒ± ekleme i√ßin prompt kullanƒ±yoruz (senin kodundaki gibi)
        const ad = prompt("√úr√ºn Adƒ±:"); if (!ad) return;
        const fiyat = prompt("Fiyat (TL):");
        const en = prompt("En (cm):");
        const boy = prompt("Boy (cm):");
        
        const statusText = document.getElementById('statusText');
        statusText.style.display = "block";
        statusText.innerText = "Geri Y√ºkleniyor...";

        const yeniUrun = { 
            id: Date.now(), 
            url: url, 
            name: ad, 
            price: fiyat || "0", 
            sku: "Ar≈üiv", 
            en: en || "160", 
            boy: boy || "230",
            collection: "Ar≈üiv",
            inStock: true 
        };

        vitrin.push(yeniUrun);
        await jsonGuncelle(vitrin);
        
        statusText.style.display = "none";
        vitriniCiz();
        arsiviGetir();
    }

    async function urunuYukle() {
        const file = document.getElementById('fileInput').files[0];
        
        // Yeni eklediƒüimiz inputlarƒ± alƒ±yoruz
        const name = document.getElementById('nameInput').value;
        const price = document.getElementById('priceInput').value;
        const sku = document.getElementById('skuInput').value;
        const en = document.getElementById('enInput').value;
        const boy = document.getElementById('boyInput').value;
        const coll = document.getElementById('collInput').value;

        if (!file || !name || !en || !boy) { alert("L√ºtfen Fotoƒüraf, Ad, En ve Boy bilgilerini girin."); return; }

        const statusText = document.getElementById('statusText');
        statusText.style.display = "block";
        statusText.innerText = "HD Optimizasyon... ‚è≥";

        const url = URL.createObjectURL(file);
        const img = new Image();
        img.src = url;

        img.onload = async function() {
            URL.revokeObjectURL(url); 
            const canvas = document.createElement('canvas');
            const MAX_BOYUT = 1500; 
            let width = img.width; let height = img.height;

            if (width > height) { if (width > MAX_BOYUT) { height = Math.round(height * (MAX_BOYUT / width)); width = MAX_BOYUT; } } 
            else { if (height > MAX_BOYUT) { width = Math.round(width * (MAX_BOYUT / height)); height = MAX_BOYUT; } }

            canvas.width = width; canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = true; ctx.imageSmoothingQuality = "high";
            ctx.drawImage(img, 0, 0, width, height);

            const base64Content = canvas.toDataURL('image/jpeg', 0.85).split(',')[1];
            const dosyaAdi = "img_" + Date.now() + ".jpg"; 

            statusText.innerText = "Y√ºkleniyor... ‚òÅÔ∏è";

            try {
                const resimCevap = await fetch(`https://api.github.com/repos/${KULLANICI}/${REPO}/contents/images/${dosyaAdi}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${githubToken}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: "Panel upload", content: base64Content })
                });

                if (resimCevap.ok) {
                    const resimVeri = await resimCevap.json();
                    
                    // --- BURASI KRƒ∞Tƒ∞K: Lƒ∞STEYE EKLƒ∞YOR ---
                    const yeniUrun = { 
                        id: Date.now(), 
                        url: resimVeri.content.download_url, 
                        name: name,
                        price: price,
                        sku: sku,
                        en: en, 
                        boy: boy,
                        collection: coll,
                        inStock: true
                    };
                    
                    vitrin.push(yeniUrun);
                    await jsonGuncelle(vitrin);
                    
                    statusText.style.display = "none";
                    // Formu temizle
                    document.getElementById('fileInput').value = "";
                    document.getElementById('fileNameDisplay').innerText = "Dosya se√ßilmedi";
                    document.getElementById('nameInput').value = "";
                    
                    vitriniCiz();
                    arsiviGetir();
                } else { alert("Y√ºkleme hatasƒ±!"); }
            } catch (error) { alert("Baƒülantƒ± hatasƒ±!"); }
        };
    }

    function vitriniCiz() {
        const listeDiv = document.getElementById('productList');
        listeDiv.innerHTML = "";
        
        // Ters √ßevirip √ßiz (en yeni en √ºstte)
        vitrin.slice().reverse().forEach((urun) => {
            listeDiv.innerHTML += `
                <div class="product-item">
                    <div class="product-info">
                        <img src="${urun.url}">
                        <div class="product-details">
                            <span class="title">${urun.name || "ƒ∞simsiz"}</span>
                            <span class="meta">${urun.sku || ""} ‚Ä¢ ${urun.price || "0"} TL</span>
                        </div>
                    </div>
                    <button class="btn-delete" onclick="urunuSil(${urun.id})">Sil</button>
                </div>
            `;
        });
    }

    async function urunuSil(id) {
        if (confirm("Vitrin'den kaldƒ±rƒ±lsƒ±n mƒ±? (Ar≈üive gider)")) {
            vitrin = vitrin.filter(u => u.id !== id);
            await jsonGuncelle(vitrin);
            vitriniCiz();
            arsiviGetir(); // Hemen ar≈üive d√º≈üer
        }
    }

    async function jsonGuncelle(yeniListe) {
        const url = `https://api.github.com/repos/${KULLANICI}/${REPO}/contents/vitrin.json`;
        let sha = "";
        try {
            const getCevap = await fetch(url, { headers: { 'Authorization': `token ${githubToken}` } });
            if (getCevap.ok) { const data = await getCevap.json(); sha = data.sha; }
        } catch (e) {}

        const base64Content = btoa(unescape(encodeURIComponent(JSON.stringify(yeniListe))));
        await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${githubToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: "Update", content: base64Content, sha: sha || undefined })
        });
    }
</script>

</body>
</html>
