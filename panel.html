<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YÃ¶netim Paneli | Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #09090b;
            --card-bg: #18181b;
            --input-bg: #27272a;
            --border: #3f3f46;
            --primary: #ffffff;
            --accent: #3b82f6; /* Premium Mavi */
            --danger: #ef4444;
            --success: #10b981;
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-dark);
            color: var(--primary);
            margin: 0; padding: 20px 15px;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .container { 
            max-width: 500px; margin: 0 auto; 
            padding-bottom: 80px;
        }

        h2 { text-align: center; margin: 10px 0 5px; font-size: 24px; letter-spacing: -0.5px; }
        .subtitle { text-align: center; color: #a1a1aa; font-size: 13px; margin-bottom: 25px; }

        /* --- FOTOÄžRAF ALANI (DÃœZELTÄ°LDÄ°) --- */
        .file-wrapper {
            position: relative;
            background: var(--card-bg);
            border: 2px dashed var(--border);
            border-radius: 16px;
            height: 180px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden;
            transition: 0.2s;
            margin-bottom: 25px;
        }
        .file-wrapper:active { background: #202022; border-color: var(--accent); }
        
        /* Gizli Input */
        #fileInput { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            opacity: 0; cursor: pointer; z-index: 10;
        }

        .icon-box { font-size: 40px; margin-bottom: 10px; }
        #fileName { font-size: 14px; font-weight: 500; color: #a1a1aa; pointer-events: none; }
        #previewImg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; display: none; z-index: 1; opacity: 0.6;
        }

        /* --- FORM --- */
        .form-group { display: flex; flex-direction: column; gap: 15px; }
        
        .input-label { 
            font-size: 11px; font-weight: 700; color: #71717a; 
            text-transform: uppercase; margin-bottom: 5px; display: block;
        }

        input { 
            width: 100%; padding: 14px; 
            background: var(--input-bg);
            border: 1px solid var(--border); 
            border-radius: 12px; 
            font-size: 15px; color: white;
            outline: none; transition: 0.2s;
        }
        input:focus { border-color: var(--accent); }

        .row { display: flex; gap: 12px; }
        .col { flex: 1; }

        /* --- BUTONLAR --- */
        .btn-save {
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            background: var(--accent); color: white;
            font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }
        .btn-save:active { transform: scale(0.98); }

        /* --- LÄ°STE --- */
        .list-header { 
            margin-top: 40px; border-bottom: 1px solid var(--border); 
            padding-bottom: 10px; margin-bottom: 15px; font-weight: 600;
        }

        .item { 
            background: var(--card-bg); padding: 12px; border-radius: 12px;
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 10px; border: 1px solid var(--border);
        }
        .item-left { display: flex; align-items: center; gap: 12px; }
        .item-img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; background: #333; }
        .item-info h4 { margin: 0; font-size: 14px; color: white; }
        .item-info p { margin: 2px 0 0; font-size: 12px; color: #a1a1aa; }
        
        .btn-del { 
            background: rgba(239, 68, 68, 0.2); color: var(--danger);
            border: none; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600;
        }

        /* --- YÃ¼kleme BarÄ± --- */
        #loadingBar {
            height: 4px; background: var(--accent); width: 0%; 
            position: fixed; top: 0; left: 0; transition: 0.3s; z-index: 999;
        }
    </style>
</head>
<body>

    <div id="loadingBar"></div>

    <div class="container">
        <h2>YÃ¶netim Paneli</h2>
        <div class="subtitle">ÃœrÃ¼n ve Ä°Ã§erik KontrolÃ¼</div>

        <div class="file-wrapper">
            <input type="file" id="fileInput" accept="image/*" onchange="previewFile()">
            <img id="previewImg">
            <div style="z-index: 2; text-align: center;">
                <div class="icon-box">ðŸ“¸</div>
                <div id="fileName">FotoÄŸraf SeÃ§mek Ä°Ã§in Dokun</div>
            </div>
        </div>

        <div class="form-group">
            <div>
                <span class="input-label">ÃœrÃ¼n AdÄ±</span>
                <input type="text" id="name" placeholder="Ã–rn: Klasik Gri HalÄ±">
            </div>

            <div class="row">
                <div class="col">
                    <span class="input-label">Fiyat (TL)</span>
                    <input type="number" id="price" placeholder="12500">
                </div>
                <div class="col">
                    <span class="input-label">Stok Kodu</span>
                    <input type="text" id="sku" placeholder="KOD-01">
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <span class="input-label">En (cm)</span>
                    <input type="number" id="width" placeholder="160">
                </div>
                <div class="col">
                    <span class="input-label">Boy (cm)</span>
                    <input type="number" id="height" placeholder="230">
                </div>
            </div>

            <div>
                <span class="input-label">Koleksiyon</span>
                <input type="text" id="collection" placeholder="Ã–rn: Vintage">
            </div>

            <button class="btn-save" onclick="uploadProduct()">âœ¨ Vitrine Ekle</button>
            <p id="statusMsg" style="text-align: center; font-size: 13px; color: #a1a1aa; margin-top: 10px; display: none;">...</p>
        </div>

        <div class="list-header">Aktif Vitrin</div>
        <div id="productList">YÃ¼kleniyor...</div>
    </div>

<script>
    // --- AYARLAR ---
    const USER = "fthlabz"; 
    const REPO = "sanal-kesif"; 
    // TOKEN BURAYA
    const t1 = "ghp_"; 
    const t2 = "dm7qeynDwgjzBO5uOg02AFW4OhXZXH1cMdUG"; // <--- GÃœNCEL TOKENÄ° YAPIÅžTIR
    const TOKEN = t1 + t2;

    let vitrin = [];

    // BaÅŸlangÄ±Ã§
    window.onload = async () => {
        await fetchData();
    };

    // 1. Dosya SeÃ§imi ve Ã–nizleme (Hata Ã‡Ã¶zÃ¼mÃ¼ BurasÄ±)
    function previewFile() {
        const input = document.getElementById('fileInput');
        const file = input.files[0];
        const preview = document.getElementById('previewImg');
        const nameLabel = document.getElementById('fileName');

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                nameLabel.innerText = "âœ… " + file.name;
                nameLabel.style.color = "#fff";
                nameLabel.style.textShadow = "0 2px 4px rgba(0,0,0,0.8)";
            }
            reader.readAsDataURL(file);
        }
    }

    // 2. Orijinal 1K Resim Motoru (Geri Getirildi)
    function resizeImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX = 1000; // Orijinal 1K ayarÄ±
                    let w = img.width;
                    let h = img.height;

                    if (w > h) { if (w > MAX) { h *= MAX / w; w = MAX; } }
                    else { if (h > MAX) { w *= MAX / h; h = MAX; } }

                    canvas.width = w; canvas.height = h;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, w, h);
                    
                    // 0.8 kalite (Original setting)
                    resolve(canvas.toDataURL('image/jpeg', 0.8).split(',')[1]);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    // 3. ÃœrÃ¼n YÃ¼kleme (KontrollÃ¼)
    async function uploadProduct() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];

        // Verileri al
        const name = document.getElementById('name').value;
        const price = document.getElementById('price').value;
        const sku = document.getElementById('sku').value;
        const width = document.getElementById('width').value;
        const height = document.getElementById('height').value;
        const collection = document.getElementById('collection').value;

        // Kontrol
        if (!file) { alert("âš ï¸ LÃ¼tfen fotoÄŸrafa tÄ±klayÄ±p bir resim seÃ§in!"); return; }
        if (!name || !price || !width || !height) { alert("âš ï¸ LÃ¼tfen Ã¼rÃ¼n bilgilerini doldurun."); return; }

        updateStatus("FotoÄŸraf Optimize Ediliyor... âš™ï¸");
        
        // Resmi iÅŸle
        const base64 = await resizeImage(file);
        const fileName = `images/p_${Date.now()}.jpg`;

        updateStatus("Buluta YÃ¼kleniyor... â˜ï¸");

        // GitHub'a Resim YÃ¼kle
        const imgUrl = await uploadToGithub(fileName, base64);
        
        if (imgUrl) {
            const newItem = {
                id: Date.now(),
                url: imgUrl,
                name: name,
                price: price,
                sku: sku || "STOK- YOK",
                en: width,
                boy: height,
                collection: collection,
                inStock: true
            };

            vitrin.push(newItem);
            await updateJson(vitrin);
            
            updateStatus("BaÅŸarÄ±lÄ±! Vitrin GÃ¼ncellendi âœ…");
            setTimeout(() => location.reload(), 1500);
        }
    }

    async function fetchData() {
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/main/vitrin.json?t=${Date.now()}`);
            if (res.ok) {
                vitrin = await res.json();
                renderList();
            }
        } catch (e) { console.log(e); }
    }

    function renderList() {
        const list = document.getElementById('productList');
        list.innerHTML = "";
        
        vitrin.slice().reverse().forEach(p => {
            list.innerHTML += `
                <div class="item">
                    <div class="item-left">
                        <img src="${p.url}" class="item-img">
                        <div class="item-info">
                            <h4>${p.name}</h4>
                            <p>${p.sku} â€¢ ${p.price} TL</p>
                        </div>
                    </div>
                    <button class="btn-del" onclick="deleteItem(${p.id})">Sil</button>
                </div>
            `;
        });
    }

    async function deleteItem(id) {
        if(confirm("Silmek istiyor musunuz?")) {
            vitrin = vitrin.filter(i => i.id !== id);
            await updateJson(vitrin);
            renderList();
        }
    }

    // --- API FONKSÄ°YONLARI ---
    async function uploadToGithub(path, content) {
        try {
            document.getElementById('loadingBar').style.width = "50%";
            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: "New Product", content: content })
            });
            document.getElementById('loadingBar').style.width = "100%";
            const d = await res.json();
            return d.content.download_url;
        } catch(e) { alert("YÃ¼kleme HatasÄ±! Tokeni kontrol et."); return null; }
    }

    async function updateJson(data) {
        const url = `https://api.github.com/repos/${USER}/${REPO}/contents/vitrin.json`;
        let sha = "";
        try {
            const get = await fetch(url, { headers: { 'Authorization': `token ${TOKEN}` } });
            if (get.ok) sha = (await get.json()).sha;
        } catch(e) {}

        const content = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: "Update", content: content, sha: sha || undefined })
        });
    }

    function updateStatus(msg) {
        const el = document.getElementById('statusMsg');
        el.style.display = 'block';
        el.innerText = msg;
    }
</script>
</body>
</html>
