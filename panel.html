<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Y√∂netim Paneli | Dark</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --card-bg: #1a1a1a;
            --border: #333;
            --primary: #ffffff;
            --accent: #2563eb;
            --text-muted: #888;
            --danger: #ef4444;
            --success: #10b981;
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-dark);
            color: var(--primary);
            margin: 0; padding: 20px 15px;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden; /* Saƒüa kaymayƒ± engeller */
        }

        .container { 
            max-width: 600px; margin: 0 auto; 
            padding-bottom: 50px;
        }

        h2 { font-weight: 800; font-size: 26px; margin: 0 0 5px 0; letter-spacing: -0.5px; text-align: center; }
        .subtitle { color: var(--text-muted); font-size: 14px; margin-bottom: 30px; text-align: center; }

        /* --- Form Alanƒ± --- */
        .upload-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* Fotoƒüraf Y√ºkleme Alanƒ± */
        .file-area {
            border: 2px dashed #444;
            background: #111;
            padding: 40px 20px;
            text-align: center;
            border-radius: 16px;
            margin-bottom: 25px;
            cursor: pointer;
            transition: 0.2s;
        }
        .file-area:active { background: #222; border-color: var(--accent); }
        .icon { font-size: 32px; display: block; margin-bottom: 10px; }
        #fileName { color: var(--text-muted); font-size: 14px; font-weight: 500; }

        /* Inputlar */
        .form-stack { display: flex; flex-direction: column; gap: 18px; }
        
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        .input-group label { 
            font-size: 13px; font-weight: 700; 
            color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        input, select { 
            width: 100%;
            padding: 16px; /* Daha b√ºy√ºk dokunma alanƒ± */
            background: #0f0f0f;
            border: 1px solid var(--border); 
            border-radius: 12px; 
            font-size: 16px; /* Mobilde zoom yapmamasƒ± i√ßin */
            color: white;
            outline: none; transition: 0.2s;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(37,99,235,0.2); }

        /* Yan Yana Inputlar i√ßin */
        .row { display: flex; gap: 15px; }
        .row .input-group { flex: 1; }

        /* Butonlar */
        .btn {
            width: 100%; padding: 18px; border: none; border-radius: 14px;
            font-weight: 700; font-size: 16px; cursor: pointer; margin-top: 10px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.2s;
        }
        .btn-primary { 
            background: linear-gradient(135deg, var(--accent), #1d4ed8); 
            color: white; 
            box-shadow: 0 4px 15px rgba(37,99,235,0.3);
        }
        .btn-primary:active { transform: scale(0.98); }

        /* --- √úr√ºn Listesi --- */
        .section-title { 
            margin-top: 40px; margin-bottom: 15px; 
            font-size: 18px; font-weight: 700; color: white; border-bottom: 1px solid var(--border); padding-bottom: 10px;
        }

        .product-item { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 15px; margin-bottom: 12px;
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; 
        }
        .p-info { display: flex; align-items: center; gap: 15px; }
        .p-img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; background: #333; }
        .p-details h4 { margin: 0; font-size: 16px; font-weight: 600; color: white; }
        .p-details p { margin: 4px 0 0; font-size: 13px; color: var(--text-muted); }
        
        .btn-delete { 
            background: rgba(239, 68, 68, 0.15); color: var(--danger); 
            padding: 8px 14px; border-radius: 8px; font-size: 13px; font-weight: 600; border: none; cursor: pointer;
        }

        /* --- AR≈ûƒ∞V B√ñL√úM√ú --- */
        .archive-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; 
        }
        .archive-item { 
            position: relative; aspect-ratio: 1; border-radius: 12px; overflow: hidden; 
            border: 2px solid transparent; cursor: pointer;
        }
        .archive-item img { width: 100%; height: 100%; object-fit: cover; }
        .archive-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.6);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; color: white; font-weight: bold; font-size: 24px;
        }
        .archive-item:active .archive-overlay { opacity: 1; }

        #statusText { text-align: center; margin-top: 15px; font-weight: 600; font-size: 14px; color: var(--accent); display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>Y√∂netim Paneli</h2>
    <div class="subtitle">Sanal Ke≈üif Vitrin Kontrol√º</div>

    <div class="upload-card">
        <div class="file-area" onclick="document.getElementById('fileInput').click()">
            <span class="icon">üì∏</span>
            <p id="fileName">Fotoƒüraf Se√ß veya √áek</p>
            <input type="file" id="fileInput" accept="image/*" onchange="dosyaSecildi(this)">
        </div>

        <div class="form-stack">
            <div class="input-group">
                <label>√úr√ºn Adƒ±</label>
                <input type="text" id="nameInput" placeholder="√ñrn: Gri Salon Halƒ±sƒ±">
            </div>
            
            <div class="row">
                <div class="input-group">
                    <label>Fiyat (TL)</label>
                    <input type="number" id="priceInput" placeholder="12500">
                </div>
                <div class="input-group">
                    <label>Stok Kodu</label>
                    <input type="text" id="skuInput" placeholder="IST-01">
                </div>
            </div>

            <div class="row">
                <div class="input-group">
                    <label>En (cm)</label>
                    <input type="number" id="widthInput" placeholder="160">
                </div>
                <div class="input-group">
                    <label>Boy (cm)</label>
                    <input type="number" id="heightInput" placeholder="230">
                </div>
            </div>

            <div class="input-group">
                <label>Koleksiyon</label>
                <input type="text" id="collectionInput" placeholder="√ñrn: Vintage 2024">
            </div>

            <button class="btn btn-primary" onclick="urunuKaydet()">
                ‚ú® Vitrine Ekle
            </button>
            <p id="statusText">ƒ∞≈ülem yapƒ±lƒ±yor...</p>
        </div>
    </div>

    <div class="section-title">Vitrindeki √úr√ºnler</div>
    <div id="productList">Y√ºkleniyor...</div>

    <div class="section-title">‚òÅÔ∏è Bulut Ar≈üivi (Geri Y√ºkle)</div>
    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Silinen resimler burada saklanƒ±r. Vitrine eklemek i√ßin resme tƒ±kla.</p>
    <div class="archive-grid" id="archiveGrid"></div>

</div>

<script>
    // --- GITHUB AYARLARI (TOKENƒ∞ BURAYA YAPI≈ûTIR) ---
    const KULLANICI = "fthlabz"; 
    const REPO = "sanal-kesif"; 
    const t1 = "ghp_"; 
    const t2 = "dm7qeynDwgjzBO5uOg02AFW4OhXZXH1cMdUG"; // <-- BURAYA G√úNCEL TOKENƒ∞ YAZ
    const TOKEN = t1 + t2;

    let vitrin = [];

    // Ba≈ülangƒ±√ß
    async function init() {
        // Vitrini √ßek
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/vitrin.json?t=${Date.now()}`);
            if(res.ok) vitrin = await res.json();
        } catch(e) {}
        
        listeyiCiz();
        arsiviTara(); // Ar≈üivi (kullanƒ±lmayan resimleri) bul
    }

    function dosyaSecildi(input) {
        document.getElementById('fileName').innerText = input.files[0] ? input.files[0].name : "Fotoƒüraf Se√ßildi ‚úÖ";
        document.getElementById('fileName').style.color = "#10b981";
    }

    // --- 1. √úR√úN Y√úKLEME ---
    async function urunuKaydet() {
        const file = document.getElementById('fileInput').files[0];
        const data = verileriAl();

        if(!data) { alert("L√ºtfen t√ºm alanlarƒ± doldurun."); return; }

        gosterDurum("G√∂rsel ƒ∞≈üleniyor... ‚öôÔ∏è");
        
        let imgUrl = "";

        // Eƒüer dosya se√ßildiyse yeni y√ºkle, se√ßilmediyse ar≈üivden url kullanƒ±yoruzdur (bu fonksiyonu ar≈üiv i√ßin de kullanabiliriz ilerde)
        if (file) {
            const base64 = await resizeImage(file);
            const fileName = `images/img_${Date.now()}.jpg`;
            gosterDurum("Buluta Y√ºkleniyor... ‚òÅÔ∏è");
            imgUrl = await uploadToGithub(fileName, base64);
        } else {
            alert("L√ºtfen bir fotoƒüraf se√ßin.");
            return;
        }
        
        if(imgUrl) {
            await jsonaEkle(imgUrl, data);
            gosterDurum("Ba≈üarƒ±lƒ±! ‚úÖ");
            setTimeout(() => location.reload(), 1500);
        }
    }

    function verileriAl() {
        const name = document.getElementById('nameInput').value;
        const price = document.getElementById('priceInput').value;
        const en = document.getElementById('widthInput').value;
        const boy = document.getElementById('heightInput').value;
        const sku = document.getElementById('skuInput').value;
        const coll = document.getElementById('collectionInput').value;

        if(!name || !price || !en || !boy) return null;

        return { name, price, en, boy, sku, collection: coll, inStock: true };
    }

    // --- 2. Sƒ∞LME (Sadece JSON'dan siler, dosya kalƒ±r -> Ar≈üive d√º≈üer) ---
    async function sil(id) {
        if(confirm("√úr√ºn vitrinden kaldƒ±rƒ±lsƒ±n mƒ±? (Ar≈üivde saklanacak)")) {
            gosterDurum("Kaldƒ±rƒ±lƒ±yor...");
            vitrin = vitrin.filter(x => x.id !== id);
            await updateJson(vitrin);
            listeyiCiz();
            arsiviTara(); // Silinen anƒ±nda ar≈üive d√º≈üs√ºn
            gosterDurum("Kaldƒ±rƒ±ldƒ± üëç");
            setTimeout(() => document.getElementById('statusText').style.display='none', 2000);
        }
    }

    // --- 3. AR≈ûƒ∞VDEN GERƒ∞ Y√úKLEME ---
    async function arsivdenEkle(url) {
        // Kullanƒ±cƒ±ya hƒ±zlƒ±ca veri girmesi i√ßin prompt a√ßalƒ±m
        const ad = prompt("√úr√ºn Adƒ±:", "Ar≈üiv √úr√ºn√º");
        if(!ad) return;
        const fiyat = prompt("Fiyat (TL):", "0");
        const en = prompt("En (cm):", "160");
        const boy = prompt("Boy (cm):", "230");

        gosterDurum("Ar≈üivden Vitrine Alƒ±nƒ±yor... ‚è≥");

        const data = { 
            name: ad, price: fiyat, en: en, boy: boy, 
            sku: "ARSV-"+Math.floor(Math.random()*1000), 
            collection: "Ar≈üiv", inStock: true 
        };

        await jsonaEkle(url, data);
        gosterDurum("Geri Y√ºklendi! ‚ôªÔ∏è");
        listeyiCiz();
        arsiviTara();
    }

    // --- YARDIMCI FONKSƒ∞YONLAR ---

    async function jsonaEkle(url, meta) {
        const yeniUrun = { id: Date.now(), url: url, ...meta };
        vitrin.push(yeniUrun);
        await updateJson(vitrin);
    }

    // GitHub Klas√∂r√ºn√º Tara ve Vitrinde OLMAYANLARI bul
    async function arsiviTara() {
        try {
            const res = await fetch(`https://api.github.com/repos/${KULLANICI}/${REPO}/contents/images`, {
                headers: { 'Authorization': `token ${TOKEN}` }
            });
            if(res.ok) {
                const tumDosyalar = await res.json();
                const aktifUrller = vitrin.map(u => u.url); // Vitrindeki linkler
                
                // Ar≈üiv = Klas√∂rde var ama Vitrinde yok
                const arsivDosyalari = tumDosyalar.filter(d => 
                    d.name.match(/\.(jpg|jpeg|png|webp)$/i) && 
                    !aktifUrller.includes(d.download_url)
                );

                const grid = document.getElementById('archiveGrid');
                grid.innerHTML = "";
                if(arsivDosyalari.length === 0) grid.innerHTML = "<p style='color:#555; font-size:12px;'>Ar≈üiv bo≈ü.</p>";

                arsivDosyalari.forEach(dosya => {
                    grid.innerHTML += `
                        <div class="archive-item" onclick="arsivdenEkle('${dosya.download_url}')">
                            <img src="${dosya.download_url}" loading="lazy">
                            <div class="archive-overlay">+</div>
                        </div>
                    `;
                });
            }
        } catch(e) { console.log("Ar≈üiv hatasƒ±", e); }
    }

    function listeyiCiz() {
        const list = document.getElementById('productList');
        list.innerHTML = "";
        vitrin.slice().reverse().forEach(u => {
            list.innerHTML += `
                <div class="product-item">
                    <div class="p-info">
                        <img src="${u.url}" class="p-img">
                        <div class="p-details">
                            <h4>${u.name}</h4>
                            <p>${u.en}x${u.boy}cm ‚Ä¢ <b>${u.price} TL</b></p>
                        </div>
                    </div>
                    <button class="btn-delete" onclick="sil(${u.id})">Kaldƒ±r</button>
                </div>
            `;
        });
    }

    function gosterDurum(msg) {
        const el = document.getElementById('statusText');
        el.style.display = 'block'; el.innerText = msg;
    }

    // G√∂rsel K√º√ß√ºltme (Mobil Performans ƒ∞√ßin)
    function resizeImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX = 1200; // 1200px yeterli
                    let w = img.width, h = img.height;
                    if (w > h) { if (w > MAX) { h *= MAX / w; w = MAX; } }
                    else { if (h > MAX) { w *= MAX / h; h = MAX; } }
                    canvas.width = w; canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    resolve(canvas.toDataURL('image/jpeg', 0.8).split(',')[1]);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    async function uploadToGithub(path, content) {
        try {
            const res = await fetch(`https://api.github.com/repos/${KULLANICI}/${REPO}/contents/${path}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: "Panelden y√ºkleme", content: content })
            });
            const data = await res.json();
            return data.content.download_url;
        } catch(e) { alert("Y√ºkleme ba≈üarƒ±sƒ±z! Token hatasƒ± olabilir."); return null; }
    }

    async function updateJson(data) {
        const url = `https://api.github.com/repos/${KULLANICI}/${REPO}/contents/vitrin.json`;
        let sha = "";
        try {
            const get = await fetch(url, { headers: { 'Authorization': `token ${TOKEN}` } });
            if(get.ok) sha = (await get.json()).sha;
        } catch(e) {}

        const content = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: "Vitrin g√ºncelleme", content: content, sha: sha || undefined })
        });
    }

    init();
</script>

</body>
</html>
