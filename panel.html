<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanal KeÅŸif | YÃ¶netim Paneli</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #000000;
            --accent: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #0f172a;
            --text-muted: #64748b;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg);
            color: var(--text);
            margin: 0; padding: 20px;
            -webkit-font-smoothing: antialiased;
        }

        .container { 
            max-width: 800px; margin: 0 auto; 
            background: var(--card); padding: 40px; 
            border-radius: 24px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
        }

        h2 { font-weight: 700; font-size: 24px; margin-bottom: 5px; letter-spacing: -0.5px; }
        .subtitle { color: var(--text-muted); font-size: 14px; margin-bottom: 30px; }

        /* Form Grid */
        .form-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            margin-bottom: 20px;
        }
        
        .full-width { grid-column: span 2; }

        .input-group { display: flex; flex-direction: column; gap: 6px; }
        .input-group label { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }
        
        input, select { 
            padding: 12px; border: 1px solid var(--border); 
            border-radius: 10px; font-size: 14px; outline: none; transition: 0.2s;
            background: #f8fafc;
        }
        input:focus { border-color: var(--accent); background: #fff; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }

        /* File Upload */
        .file-area {
            border: 2px dashed var(--border); padding: 30px; text-align: center;
            border-radius: 16px; margin-bottom: 25px; cursor: pointer; transition: 0.2s;
        }
        .file-area:hover { border-color: var(--accent); background: #eff6ff; }
        input[type="file"] { display: none; }

        /* Buttons */
        .btn {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 15px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #333; }
        
        .btn-delete { background: #fee2e2; color: #dc2626; padding: 8px 16px; width: auto; font-size: 13px; }
        .btn-delete:hover { background: #fecaca; }

        /* Product List */
        .product-list { margin-top: 40px; display: flex; flex-direction: column; gap: 15px; }
        .product-item { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 15px; border: 1px solid var(--border); border-radius: 16px; 
            background: white;
        }
        .p-info { display: flex; align-items: center; gap: 15px; }
        .p-img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; background: #eee; }
        .p-details h4 { margin: 0; font-size: 15px; font-weight: 600; }
        .p-details p { margin: 2px 0 0; font-size: 13px; color: var(--text-muted); }
        .badge { 
            font-size: 10px; padding: 4px 8px; border-radius: 6px; 
            background: #e2e8f0; color: #475569; font-weight: 600;
        }

        #statusText { text-align: center; margin-top: 15px; font-weight: 600; font-size: 14px; color: var(--accent); display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>MaÄŸaza YÃ¶netim Paneli</h2>
    <div class="subtitle">Sanal KeÅŸif Vitrini Ä°Ã§erik YÃ¶netimi</div>

    <div class="file-area" onclick="document.getElementById('fileInput').click()">
        <span style="font-size: 24px;">ðŸ“¸</span>
        <p id="fileName">FotoÄŸraf SeÃ§mek Ä°Ã§in TÄ±klayÄ±n</p>
        <input type="file" id="fileInput" accept="image/*" onchange="dosyaSecildi(this)">
    </div>

    <div class="form-grid">
        <div class="input-group full-width">
            <label>ÃœrÃ¼n AdÄ±</label>
            <input type="text" id="nameInput" placeholder="Ã–rn: Royal Serisi Gri HalÄ±">
        </div>
        
        <div class="input-group">
            <label>Koleksiyon / Kategori</label>
            <input type="text" id="collectionInput" placeholder="Ã–rn: Vintage 2024">
        </div>

        <div class="input-group">
            <label>Stok Kodu (SKU)</label>
            <input type="text" id="skuInput" placeholder="Ã–rn: IST-2045">
        </div>

        <div class="input-group">
            <label>Fiyat (TL)</label>
            <input type="number" id="priceInput" placeholder="12500">
        </div>

        <div class="input-group">
            <label>Stok Durumu</label>
            <select id="stockInput">
                <option value="true">Stokta Var</option>
                <option value="false">TÃ¼kendi</option>
            </select>
        </div>

        <div class="input-group">
            <label>En (cm)</label>
            <input type="number" id="widthInput" placeholder="160">
        </div>
        <div class="input-group">
            <label>Boy (cm)</label>
            <input type="number" id="heightInput" placeholder="230">
        </div>
    </div>

    <button class="btn btn-primary" onclick="urunuKaydet()">âœ¨ ÃœrÃ¼nÃ¼ Vitrine Ekle</button>
    <p id="statusText">Ä°ÅŸlem yapÄ±lÄ±yor...</p>

    <div class="product-list" id="productList">
        </div>
</div>

<script>
    // --- GITHUB AYARLARI (Kendi bilgilerini gir) ---
    const KULLANICI = "fthlabz"; 
    const REPO = "sanal-kesif"; 
    // GITHUB TOKEN BURAYA (ParÃ§alÄ± yapÄ±ÅŸtÄ±r)
    const t1 = "ghp_"; 
    const t2 = "SENIN_TOKEN_KODUN_BURAYA"; // <--- BURAYI GÃœNCELLE
    const TOKEN = t1 + t2;

    let vitrin = [];

    async function init() {
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${KULLANICI}/${REPO}/main/vitrin.json?t=${Date.now()}`);
            if(res.ok) {
                vitrin = await res.json();
                listeyiCiz();
            }
        } catch(e) { console.log("Vitrin boÅŸ veya okunamadÄ±"); }
    }

    function dosyaSecildi(input) {
        document.getElementById('fileName').innerText = input.files[0] ? input.files[0].name : "FotoÄŸraf SeÃ§";
    }

    async function urunuKaydet() {
        const file = document.getElementById('fileInput').files[0];
        const data = {
            name: document.getElementById('nameInput').value,
            collection: document.getElementById('collectionInput').value,
            sku: document.getElementById('skuInput').value,
            price: document.getElementById('priceInput').value,
            inStock: document.getElementById('stockInput').value === 'true',
            en: document.getElementById('widthInput').value,
            boy: document.getElementById('heightInput').value
        };

        if(!file || !data.name || !data.price || !data.en || !data.boy) {
            alert("LÃ¼tfen fotoÄŸraf ve tÃ¼m bilgileri eksiksiz doldurun.");
            return;
        }

        gosterDurum("GÃ¶rsel Optimize Ediliyor... âš™ï¸");

        // GÃ¶rseli Base64'e Ã§evir ve kÃ¼Ã§Ã¼lt
        const base64 = await resizeImage(file);
        const fileName = `products/img_${Date.now()}.jpg`;

        gosterDurum("GÃ¶rsel Buluta YÃ¼kleniyor... â˜ï¸");

        // 1. Resmi GitHub'a yÃ¼kle
        const imgUrl = await uploadToGithub(fileName, base64);
        
        if(imgUrl) {
            // 2. JSON'a ekle
            const yeniUrun = {
                id: Date.now(),
                url: imgUrl,
                ...data
            };
            
            vitrin.push(yeniUrun);
            await updateJson(vitrin);
            
            gosterDurum("BaÅŸarÄ±lÄ±! Vitrin GÃ¼ncellendi âœ…");
            setTimeout(() => { location.reload(); }, 1500);
        }
    }

    function gosterDurum(msg) {
        const el = document.getElementById('statusText');
        el.style.display = 'block';
        el.innerText = msg;
    }

    // Canvas ile gÃ¶rseli optimize et (Max 1500px)
    function resizeImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX = 1500;
                    let w = img.width, h = img.height;
                    
                    if (w > h) { if (w > MAX) { h *= MAX / w; w = MAX; } }
                    else { if (h > MAX) { w *= MAX / h; h = MAX; } }

                    canvas.width = w; canvas.height = h;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, w, h);
                    resolve(canvas.toDataURL('image/jpeg', 0.85).split(',')[1]);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    async function uploadToGithub(path, content) {
        try {
            const res = await fetch(`https://api.github.com/repos/${KULLANICI}/${REPO}/contents/${path}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: "Yeni Ã¼rÃ¼n eklendi", content: content })
            });
            const data = await res.json();
            return data.content.download_url;
        } catch(e) { alert("Resim yÃ¼kleme hatasÄ±!"); return null; }
    }

    async function updateJson(data) {
        const url = `https://api.github.com/repos/${KULLANICI}/${REPO}/contents/vitrin.json`;
        let sha = "";
        try {
            const get = await fetch(url, { headers: { 'Authorization': `token ${TOKEN}` } });
            if(get.ok) sha = (await get.json()).sha;
        } catch(e) {}

        const content = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: "Vitrin gÃ¼ncelleme", content: content, sha: sha || undefined })
        });
    }

    async function sil(id) {
        if(confirm("ÃœrÃ¼nÃ¼ silmek istediÄŸinize emin misiniz?")) {
            vitrin = vitrin.filter(x => x.id !== id);
            await updateJson(vitrin);
            listeyiCiz();
        }
    }

    function listeyiCiz() {
        const list = document.getElementById('productList');
        list.innerHTML = "";
        vitrin.reverse().forEach(u => {
            list.innerHTML += `
                <div class="product-item">
                    <div class="p-info">
                        <img src="${u.url}" class="p-img">
                        <div class="p-details">
                            <h4>${u.name} <span class="badge">${u.sku}</span></h4>
                            <p>${u.collection} â€¢ ${u.en}x${u.boy}cm â€¢ <b>${u.price} TL</b></p>
                        </div>
                    </div>
                    <button class="btn btn-delete" onclick="sil(${u.id})">Sil</button>
                </div>
            `;
        });
    }

    init();
</script>
</body>
</html>
